{"pageProps":{"frontmatter":{"title":"Laion translated: 3B captions translated to English from laion5B","author":"Marianna Nezhurina, Romain Beaumont, Richard Vencu and Christoph Schuhmann","date":"Sep 15, 2022","previewImg":"/images/blog/laion-2B-translated-samples.png"},"content":"\nAuthor: [Marianna Nezhurina](https://github.com/marianna13) [Romain Beaumont](https://github.com/rom1504/) [Richard Vencu](https://github.com/rvencu) [Christoph Schuhmann](https://github.com/christophschuhmann)  \n\nLaion5B dataset was automatically collected from a section of the human web (common crawl). Can models generate different and interesting data compared to what humans write?\n\nThat’s a question we are interested in investigating. To let the community study it, we translated 3B samples of Laion5B from many languages into English.\n\nWe released 3 billions captions for the multilingual part of Laion5B. This makes it possible to use the whole Laion5B dataset to train English models. This also enables training models using these aligned pairs such as [Multilingual-CLIP](https://github.com/FreddeFrallan/Multilingual-CLIP).\n\nWe’re curious what you will do using it!\n\n\n## Downloading it\n\nThe dataset is available in huggingface as parquet files containing the caption, translated caption and urls.\n\n[laion1B-nolang-joined-translated-to-en](https://huggingface.co/datasets/laion/laion1B-nolang-joined-translated-to-en) \n\n[laion2B-multi-joined-translated-to-en](https://huggingface.co/datasets/laion/laion2B-multi-joined-translated-to-en)  \n\n\n## Processing\n\nEvery caption of the original dataset was translated with Facebook’s [M2M100 1.2B model](https://huggingface.co/facebook/m2m100_1.2B) using the following [script](https://github.com/marianna13/translate_dataset/blob/main/translate_data.py). All other fields remain the same as in the original [LAION2B Multi Joined](https://huggingface.co/datasets/laion/laion2B-multi-joined). To make translation possible the original dataset was split into parts with 50k samples in each and every such small part was translated in parallel on GPU nodes and saved in a separate parquet file. The speed of translation depends on the number of nodes and GPUs. The processing was done with 20 nodes with 8 GPUs in each and the speed of translation (including preprocessing and data loading) is 34 samples/per GPU/per second. Then, all translated parquets were [merged together using Spark](https://github.com/marianna13/translate_dataset/blob/main/join_additional.py) and saved as 128 parquet files. The resulting dataset was [joined with the aesthetics scores](https://github.com/marianna13/translate_dataset/blob/main/join_aesthetics.py). \n\n\n## Dataset columns\n\n\n\n* TEXT (the original text of caption)\n* LANGUAGE (language of the original TEXT)\n* ENG TEXT (translation in English of the original TEXT)\n* URL (URL of the image)\n* WIDTH (width of the image)\n* HEIGHT (height of the image)\n* Hash (hash of the URL and TEXT)\n* Pwatermark (probability of being a watermarked image, computed using our [watermark detector](https://github.com/LAION-AI/LAION-5B-WatermarkDetection))\n* Punsafe (probability of being an unsafe image, computed using our [clip based detector](https://github.com/LAION-AI/CLIP-based-NSFW-Detector))\n* Similarity (cosine between text and image ViT-B/32 embeddings, clip for en, mclip for multi and nolang)\n* Prediction (aesthetics score)\n\n\n## Samples from the translated dataset:\n\n\n![laion-2B-translated-samples](/images/blog/laion-translated-samples.png \"laion-2B-translated-samples\")\n\n\n\n## Laion2B-multi-translated\n\n\n### Dataset stats\n\n_Note. Dataset stats were computed using [this](https://github.com/marianna13/translate_dataset/blob/main/get_dataset_stats.py) script._\n\nNumber of uniques 2266M (2266193302)                                            \n\nNumber with WIDTH >= 0 and WIDTH &lt;= 128 160M (160260569)                        \n\nNumber with WIDTH >= 128 and WIDTH &lt;= 256 734M (734166164)                      \n\nNumber with WIDTH >= 256 and WIDTH &lt;= 512 849M (849569769)                      \n\nNumber with WIDTH >= 512 and WIDTH &lt;= 1024 457M (457572747)                     \n\nNumber with WIDTH >= 1024 86M (86750813)                                        \n\nNumber with HEIGHT >= 0 and HEIGHT &lt;= 128 103M (103514467)                      \n\nNumber with HEIGHT >= 128 and HEIGHT &lt;= 256 614M (614490681)                    \n\nNumber with HEIGHT >= 256 and HEIGHT &lt;= 512 753M (753540968)                    \n\nNumber with HEIGHT >= 512 and HEIGHT &lt;= 1024 686M (686553437)                   \n\nNumber with HEIGHT >= 1024 153M (153139456)                                     \n\nNumber with lenengtext >= 0 and lenengtext &lt;= 25 506M (506238532)               \n\nNumber with lenengtext >= 25 and lenengtext &lt;= 50 849M (849160165)              \n\nNumber with lenengtext >= 50 and lenengtext &lt;= 100 840M (840635023)             \n\nNumber with lenengtext >= 100 and lenengtext &lt;= 150 136M (136709119)            \n\nNumber with lenengtext >= 150 5M (5148507)\n\n\n### Similarities between text and images\n\n10000 images and captions were sampled from the dataset, [CLIP embeddings were computed](https://github.com/marianna13/translate_dataset/blob/main/get_clip_embs_similarities.py) (for original texts embeddings were computed using Multilingual CLIP). Then dot products between image and text embeddings were computed (for both original and translated dataset) to get similarities between texts and images. Here’s the distribution of average similarities for two datasets:\n\nSimilarity for original dataset:\n\n10% quantile -  0.2552971839904785\n\n20% quantile -  0.2633610963821411\n\n30% quantile -  0.2694466710090637\n\n40% quantile -  0.2750270366668701\n\n50% quantile -  0.28088638186454773\n\n60% quantile -  0.28750720620155334\n\n70% quantile -  0.2950591444969177\n\n80% quantile -  0.3049575388431549\n\n90% quantile -  0.32077282667160034\n\nSimilarity for translated dataset:\n\n10% quantile  -  0.23388671875\n\n20% quantile  -  0.25390625\n\n30% quantile  -  0.265869140625\n\n40% quantile  -  0.2763671875\n\n50% quantile  -  0.2861328125\n\n60% quantile  -  0.29638671875\n\n70% quantile  -  0.306884765625\n\n80% quantile  -  0.31982421875\n\n90% quantile  -  0.338134765625\n\n\n\n![laion-2B-translated](/images/blog/laion-2B-translated.png \"laion-2B-translated\")\n\n\n\n## Laion1B-nolang-translated\n\n[LAION1B Nolang Joined](https://huggingface.co/datasets/laion/laion1B-nolang-joined) dataset was also translated with a similar [script](https://github.com/marianna13/translate_dataset/tree/main) and in the same way as Multi. This dataset doesn’t have the language column so the model also had to determine language. All other columns in the Nolang dataset are the same as in Multi. And just like translated [LAION2B Multi Joined](https://huggingface.co/datasets/laion/laion2B-multi-joined), LAION1B Nolang was also joined with corresponding [aesthetics scores](https://github.com/marianna13/translate_dataset/blob/main/join_aesthetics.py).\n\n\n### Nolang dataset Stats\n\nNumber of uniques 1260M (1260048307)                                            \n\nNumber with WIDTH >= 0 and WIDTH &lt;= 128 90M (90701133)                          \n\nNumber with WIDTH >= 128 and WIDTH &lt;= 256 409M (409575445)                      \n\nNumber with WIDTH >= 256 and WIDTH &lt;= 512 475M (475885337)                      \n\nNumber with WIDTH >= 512 and WIDTH &lt;= 1024 239M (239035772)                     \n\nNumber with WIDTH >= 1024 59M (59942110)                                        \n\nNumber with HEIGHT >= 0 and HEIGHT &lt;= 128 59M (59814914)                        \n\nNumber with HEIGHT >= 128 and HEIGHT &lt;= 256 370M (370913206)                    \n\nNumber with HEIGHT >= 256 and HEIGHT &lt;= 512 451M (451897702)                    \n\nNumber with HEIGHT >= 512 and HEIGHT &lt;= 1024 316M (316723245)                   \n\nNumber with HEIGHT >= 1024 87M (87671543)                                       \n\nNumber with lenengtext >= 0 and lenengtext &lt;= 25 312M (312548202)               \n\nNumber with lenengtext >= 25 and lenengtext &lt;= 50 555M (555971621)              \n\nNumber with lenengtext >= 50 and lenengtext &lt;= 100 413M (413430230)             \n\nNumber with lenengtext >= 100 and lenengtext &lt;= 150 20M (20446701)              \n\nNumber with lenengtext >= 150 0M (138974)  \n\n\n### Similarities between text and images for Nolang\n\n10000 images and captions were randomly sampled from the dataset, [CLIP embeddings were computed](https://github.com/marianna13/translate_dataset/blob/main/get_clip_embs_similarities.py) (for original texts embeddings were computed using Multilingual CLIP). Then dot products between image and text embeddings were computed (for both original and translated dataset) to get similarities between texts and images. Here’s the distribution of average similarities for two datasets:\n\nSimilarity for original dataset:\n\n10% quantile  -  0.258196085691452\n\n20% quantile  -  0.266357421875\n\n30% quantile  -  0.2728866934776306\n\n40% quantile  -  0.27902457118034363\n\n50% quantile  -  0.28590404987335205\n\n60% quantile  -  0.29329144954681396\n\n70% quantile  -  0.3023602366447449\n\n80% quantile  -  0.31363412737846375\n\n90% quantile  -  0.3313804566860199\n\nSimilarity for translated dataset:\n\n10% quantile  -  0.2406005859375\n\n20% quantile  -  0.2607421875\n\n30% quantile  -  0.27490234375\n\n40% quantile  -  0.2861328125\n\n50% quantile  -  0.296142578125\n\n60% quantile  -  0.306396484375\n\n70% quantile  -  0.317626953125\n\n80% quantile  -  0.33203125\n\n90% quantile  -  0.353271484375\n\n\n![laion-1B-translated](/images/blog/laion-1B-translated.png \"laion-1B-translated\")\n\n\n## Credit\n\n\n\n* [Marianna Nezhurina](https://github.com/marianna13) translated the samples, packaged them, computed stats and wrote most of this post\n* [Romain Beaumont](https://github.com/rom1504/) helped out on packaging and scaling\n* [Richard Vencu](https://github.com/rvencu) set up all the infra that made using idle compute possible\n* [Christoph Schuhmann](https://github.com/christophschuhmann) suggested the project and guided the work to completion\n\nWe thank [https://stability.ai/](https://stability.ai/) for providing the compute for this massive translation. This was a great use of pre-emptible jobs to fill any idle compute available!","slug":"laion-translated"},"__N_SSG":true}